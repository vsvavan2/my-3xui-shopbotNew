# Инструкция по обновлению бота

Эта инструкция поможет вам обновить бота на вашем сервере (Ubuntu), сохранив всех пользователей, настройки и активные подписки.

> **Важно:** Все данные пользователей хранятся в файле `users.db`. Этот файл **не** затрагивается при обновлении кода, так как он добавлен в исключения git.

---

## Вариант 1: Миграция с другой версии (Ваш случай)

Если у вас установлена предыдущая версия бота (например, от другого разработчика) и вы хотите перейти на эту версию без потери данных.

### 1. Зайдите в папку с установленным ботом
Обычно это `3xui-shopbot`:
```bash
cd 3xui-shopbot
```

### 2. Остановите бота
```bash
sudo docker-compose down
```

### 3. Сделайте резервную копию (Обязательно!)
Сохраним базу данных и настройки в отдельную папку `/tmp`, чтобы не потерять их.
```bash
cp users.db /tmp/users.db.backup
cp .env /tmp/.env.backup
```

### 4. Смените репозиторий и обновите код
Мы переключим git на новый репозиторий и принудительно обновим файлы.
```bash
# Устанавливаем адрес нового репозитория
git remote set-url origin https://github.com/vsvavan2/my-3xui-shopbot.git

# Скачиваем обновления
git fetch origin

# Принудительно обновляем код до последней версии (ваши БД и .env не пострадают)
git reset --hard origin/main
```

### 5. Проверьте настройки
Если в новой версии появились новые параметры в `.env`, вам может потребоваться их добавить. Но для начала можно попробовать запустить со старым файлом.

### 6. Запустите бота
```bash
sudo docker-compose up -d --build
```

Теперь бот обновлен. Проверьте его работу через `/start` в Telegram.

---

## Вариант 2: Стандартное обновление

Используйте этот метод в будущем, когда вы уже перешли на репозиторий `vsvavan2`.

**Способ А: Через скрипт (если папка называется `my-3xui-shopbot`)**
```bash
curl -sSL https://raw.githubusercontent.com/vsvavan2/my-3xui-shopbot/main/install.sh | sudo bash
```

**Способ Б: Вручную (универсальный)**
```bash
cd my-3xui-shopbot
git pull
sudo docker-compose down --remove-orphans
sudo docker-compose up -d --build
```

---

## Если что-то пошло не так (Восстановление)

Если бот не видит пользователей или базу данных:
1. Остановите бота: `sudo docker-compose down`
2. Верните резервную копию:
   ```bash
   cp /tmp/users.db.backup ./users.db
   cp /tmp/.env.backup ./.env
   ```
3. Запустите снова: `sudo docker-compose up -d`
